<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<!-- GLOBAL LOADING OVERLAY -->
<div *ngIf="showGlobalLoading" class="fixed inset-0 bg-black/70 z-[9999] flex items-center justify-center">
    <div class="bg-white dark:bg-surface-800 rounded-2xl p-8 shadow-2xl max-w-md w-full mx-4">
        <div class="text-center">
            <p-progressSpinner styleClass="w-16 h-16 mx-auto mb-4"></p-progressSpinner>
            <h3 class="text-xl font-bold text-[var(--text-color)] mb-2">{{ islemDurumu }}</h3>
            <p-progressBar [value]="islemYuzdesi" [showValue]="false" styleClass="mb-4"></p-progressBar>
            <p class="text-sm text-[var(--text-color-secondary)]">Lütfen bekleyiniz, işlem devam ediyor...</p>
            <div class="mt-4 flex items-center justify-center gap-2 text-xs text-[var(--text-color-secondary)]">
                <i class="pi pi-info-circle"></i>
                <span>Adım {{ currentStep + 1 }} / {{ processingSteps.length }}</span>
            </div>
        </div>
    </div>
</div>

<!-- MOBILE NATIVE VIEW -->
<div class="onay-page block md:hidden">
    <!-- Mobile Native Header -->
    <div class="mobile-page-header">
        <div class="page-title-section">
            <h1 class="page-title">Onaylar</h1>
            <div class="pending-count">
                <span class="count-badge">{{ vardiyalar.length + marketVardiyalar.length + silinmeTalepleri.length
                    }}</span>
                <span class="count-text">bekleyen</span>
            </div>
        </div>
    </div>

    <!-- iOS Style Segment Control -->
    <div class="segment-control-container">
        <div class="segment-control">
            <button class="segment-btn" [class.active]="activeView === 'pompa'" (click)="activeView = 'pompa'">
                <i class="pi pi-car"></i>
                <span>Pompa</span>
                <span *ngIf="vardiyalar.length > 0" class="segment-badge">{{ vardiyalar.length }}</span>
            </button>
            <button class="segment-btn" [class.active]="activeView === 'market'" (click)="activeView = 'market'">
                <i class="pi pi-shopping-bag"></i>
                <span>Market</span>
                <span *ngIf="marketVardiyalar.length > 0" class="segment-badge warn">{{ marketVardiyalar.length
                    }}</span>
            </button>
            <button class="segment-btn" [class.active]="activeView === 'silinme'" (click)="activeView = 'silinme'">
                <i class="pi pi-trash"></i>
                <span>Silme</span>
                <span *ngIf="silinmeTalepleri.length > 0" class="segment-badge danger">{{ silinmeTalepleri.length
                    }}</span>
            </button>
        </div>
    </div>

    <!-- Mobile Content Area -->
    <div class="mobile-approval-list">
        <!-- POMPA MOBILE -->
        <ng-container *ngIf="activeView === 'pompa'">
            <ng-container *ngIf="vardiyalar.length > 0; else pompaEmpty">
                <div *ngFor="let vardiya of vardiyalar" class="mobile-approval-card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">{{ vardiya.dosyaAdi }}</div>
                            <div class="card-id">#{{ vardiya.id }} • {{ vardiya.istasyonAdi }}</div>
                        </div>
                        <div class="card-amount">{{ vardiya.genelToplam | currency:'TRY':'symbol-narrow':'1.0-0' }}
                        </div>
                    </div>
                    <div class="card-body">
                        <span class="card-meta"><i class="pi pi-calendar"></i>{{ vardiya.baslangicTarihi |
                            date:'dd.MM.yyyy' }}</span>
                        <span class="status-tag pending"><i class="pi pi-clock"></i>Onay Bekliyor</span>
                    </div>
                    <div class="card-actions">
                        <button class="action-btn btn-primary" (click)="incele(vardiya)">
                            <i class="pi pi-search"></i> İncele
                        </button>
                    </div>
                </div>
            </ng-container>
            <ng-template #pompaEmpty>
                <div class="mobile-empty-state">
                    <div class="empty-icon"><i class="pi pi-check-circle"></i></div>
                    <div class="empty-title">Bekleyen Onay Yok</div>
                    <div class="empty-text">Tüm pompa vardiyaları onaylanmış.</div>
                </div>
            </ng-template>
        </ng-container>

        <!-- MARKET MOBILE -->
        <ng-container *ngIf="activeView === 'market'">
            <ng-container *ngIf="marketVardiyalar.length > 0; else marketEmpty">
                <div *ngFor="let vardiya of marketVardiyalar" class="mobile-approval-card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">Market Vardiyası</div>
                            <div class="card-id">#{{ vardiya.id }} • {{ vardiya.tarih | date:'dd.MM.yyyy' }}</div>
                        </div>
                        <div class="card-amount">{{ vardiya.toplamSatisTutari | currency:'TRY':'symbol-narrow':'1.0-0'
                            }}</div>
                    </div>
                    <div class="card-body">
                        <span class="card-meta"><i class="pi pi-arrow-up"></i>Teslimat: {{ vardiya.toplamTeslimatTutari
                            | currency:'TRY':'symbol-narrow':'1.0-0' }}</span>
                        <span class="card-meta" [ngClass]="{'text-red-500': (vardiya.toplamFark || 0) < 0}">
                            <i class="pi pi-chart-bar"></i>Fark: {{ vardiya.toplamFark |
                            currency:'TRY':'symbol-narrow':'1.0-0' }}
                        </span>
                        <span class="status-tag pending"><i class="pi pi-clock"></i>Onay Bekliyor</span>
                    </div>
                    <div class="card-actions">
                        <button class="action-btn btn-primary" (click)="marketIncele(vardiya)">
                            <i class="pi pi-search"></i> İncele
                        </button>
                    </div>
                </div>
            </ng-container>
            <ng-template #marketEmpty>
                <div class="mobile-empty-state">
                    <div class="empty-icon"><i class="pi pi-check-circle"></i></div>
                    <div class="empty-title">Bekleyen Onay Yok</div>
                    <div class="empty-text">Tüm market vardiyaları onaylanmış.</div>
                </div>
            </ng-template>
        </ng-container>

        <!-- SILINME MOBILE -->
        <ng-container *ngIf="activeView === 'silinme'">
            <ng-container *ngIf="silinmeTalepleri.length > 0; else silinmeEmpty">
                <div *ngFor="let vardiya of silinmeTalepleri" class="mobile-approval-card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">{{ vardiya.dosyaAdi }}</div>
                            <div class="card-id">#{{ vardiya.id }} • {{ vardiya.istasyonAdi }}</div>
                        </div>
                        <div class="card-amount text-red-500">{{ vardiya.genelToplam |
                            currency:'TRY':'symbol-narrow':'1.0-0' }}</div>
                    </div>
                    <div class="card-body">
                        <span class="card-meta"><i class="pi pi-calendar"></i>{{ vardiya.baslangicTarihi |
                            date:'dd.MM.yyyy' }}</span>
                        <span class="status-tag delete-request"><i class="pi pi-trash"></i>Silme Talebi</span>
                    </div>
                    <div class="card-meta" style="margin-bottom: 0.75rem; background: #fef2f2; color: #dc2626;">
                        <i class="pi pi-info-circle"></i>
                        {{ vardiya.silinmeTalebiNedeni || 'Neden belirtilmemiş' }}
                    </div>
                    <div class="card-actions">
                        <button class="action-btn btn-primary" (click)="incele(vardiya)">
                            <i class="pi pi-search"></i> İncele
                        </button>
                    </div>
                </div>
            </ng-container>
            <ng-template #silinmeEmpty>
                <div class="mobile-empty-state">
                    <div class="empty-icon"><i class="pi pi-check-circle"></i></div>
                    <div class="empty-title">Bekleyen Silme Talebi Yok</div>
                    <div class="empty-text">Tüm silme talepleri işlenmiş.</div>
                </div>
            </ng-template>
        </ng-container>
    </div>
</div>

<!-- DESKTOP VIEW -->
<div class="grid grid-cols-12 gap-6 hidden md:grid">
    <!-- Başlık Kartı -->
    <div class="col-span-12">
        <div class="card">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-surface-800 dark:text-surface-100 m-0">
                        <i class="pi pi-check-circle mr-2 text-orange-500"></i>Onay Bekleyenler
                    </h2>
                    <p class="text-surface-500 mt-2">
                        Bekleyen onay talepleri: {{ vardiyalar.length + marketVardiyalar.length +
                        silinmeTalepleri.length }}
                    </p>
                </div>
                <p-selectButton [options]="viewOptions" [(ngModel)]="activeView" optionLabel="label"
                    optionValue="value">
                    <ng-template let-item pTemplate="item">
                        <div class="flex items-center gap-2 px-2">
                            <i [class]="item.icon"></i>
                            <span>{{item.label}}</span>
                        </div>
                    </ng-template>
                </p-selectButton>
            </div>
        </div>
    </div>

    <!-- Tablo Kartı -->
    <div class="col-span-12">
        <div class="card">
            <!-- POMPA TABLOSU -->
            <div *ngIf="activeView === 'pompa'">
                <p-table [value]="vardiyalar" [loading]="loading" [paginator]="vardiyalar.length > 10" [rows]="10"
                    styleClass="p-datatable-striped" [globalFilterFields]="['dosyaAdi', 'istasyonAdi']" #dt1>
                    <ng-template pTemplate="caption">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold">Pompa Vardiyaları ({{ vardiyalar.length }})</span>
                            <p-iconfield>
                                <p-inputicon class="pi pi-search" />
                                <input pInputText type="text" placeholder="Ara..."
                                    (input)="dt1.filterGlobal($any($event.target).value, 'contains')" />
                            </p-iconfield>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr class="text-sm">
                            <th>ID</th>
                            <th>Tarih</th>
                            <th>Dosya Adı</th>
                            <th class="text-right">Toplam Tutar</th>
                            <th>İstasyon</th>
                            <th class="text-center">Durum</th>
                            <th class="text-center">İşlemler</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-vardiya>
                        <tr class="hover:bg-surface-50 dark:hover:bg-surface-800 transition-colors">
                            <td><span class="text-surface-600">#</span>{{ vardiya.id }}</td>
                            <td>{{ vardiya.baslangicTarihi | date:'dd.MM.yyyy HH:mm' }}</td>
                            <td><span class="font-bold text-surface-800 dark:text-surface-100">{{ vardiya.dosyaAdi
                                    }}</span></td>
                            <td class="text-right"><span class="font-bold text-lg text-primary">{{ vardiya.genelToplam |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span></td>
                            <td>{{ vardiya.istasyon?.ad }}</td>
                            <td class="text-center"><p-tag value="Onay Bekliyor" severity="warn"
                                    icon="pi pi-clock"></p-tag></td>
                            <td class="text-center">
                                <button pButton pRipple icon="pi pi-search" label="İncele"
                                    class="p-button-rounded p-button-text p-button-info"
                                    (click)="incele(vardiya)"></button>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="7" class="text-center py-12">
                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-24 h-24 bg-surface-100 dark:bg-surface-800 rounded-full flex items-center justify-center mb-4">
                                        <i class="pi pi-check-circle text-4xl text-green-500"></i>
                                    </div>
                                    <h4 class="text-surface-600 dark:text-surface-300 m-0">Bekleyen onay bulunmuyor</h4>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>

            <!-- MARKET TABLOSU -->
            <div *ngIf="activeView === 'market'">
                <p-table [value]="marketVardiyalar" [loading]="loading" [paginator]="marketVardiyalar.length > 10"
                    [rows]="10" styleClass="p-datatable-striped" #dt2>
                    <ng-template pTemplate="caption">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold">Market Vardiyaları ({{ marketVardiyalar.length }})</span>
                            <p-iconfield>
                                <p-inputicon class="pi pi-search" />
                                <input pInputText type="text" placeholder="Ara..."
                                    (input)="dt2.filterGlobal($any($event.target).value, 'contains')" />
                            </p-iconfield>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr class="text-sm">
                            <th>ID</th>
                            <th>Tarih</th>
                            <th class="text-right">Top. Satış</th>
                            <th class="text-right">Top. Teslimat</th>
                            <th class="text-right">Fark</th>
                            <th class="text-center">Durum</th>
                            <th class="text-center">İşlemler</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-vardiya>
                        <tr class="hover:bg-surface-50 dark:hover:bg-surface-800 transition-colors">
                            <td><span class="text-surface-600">#</span>{{ vardiya.id }}</td>
                            <td>{{ vardiya.tarih | date:'dd.MM.yyyy' }}</td>
                            <td class="text-right"><span class="font-bold">{{ vardiya.toplamSatisTutari |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span></td>
                            <td class="text-right"><span class="font-bold text-green-600">{{
                                    vardiya.toplamTeslimatTutari | currency:'TRY':'symbol-narrow':'1.2-2' }}</span></td>
                            <td class="text-right">
                                <span class="font-bold"
                                    [ngClass]="{'text-red-500': (vardiya.toplamFark || 0) < 0, 'text-blue-500': (vardiya.toplamFark || 0) > 0}">
                                    {{ vardiya.toplamFark | currency:'TRY':'symbol-narrow':'1.2-2' }}
                                </span>
                            </td>
                            <td class="text-center"><p-tag value="Onay Bekliyor" severity="warn"
                                    icon="pi pi-clock"></p-tag></td>
                            <td class="text-center">
                                <button pButton pRipple icon="pi pi-search" label="İncele"
                                    class="p-button-rounded p-button-text p-button-info"
                                    (click)="marketIncele(vardiya)"></button>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="7" class="text-center py-12">
                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-24 h-24 bg-surface-100 dark:bg-surface-800 rounded-full flex items-center justify-center mb-4">
                                        <i class="pi pi-check-circle text-4xl text-green-500"></i>
                                    </div>
                                    <h4 class="text-surface-600 dark:text-surface-300 m-0">Bekleyen market onayı
                                        bulunmuyor</h4>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>

            <!-- SILINME TABLOSU -->
            <div *ngIf="activeView === 'silinme'">
                <p-table [value]="silinmeTalepleri" [loading]="loading" [paginator]="silinmeTalepleri.length > 10"
                    [rows]="10" styleClass="p-datatable-striped" [globalFilterFields]="['dosyaAdi', 'istasyon.ad']"
                    #dt3>
                    <ng-template pTemplate="caption">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold">Silinme Talepleri ({{ silinmeTalepleri.length }})</span>
                            <p-iconfield>
                                <p-inputicon class="pi pi-search" />
                                <input pInputText type="text" placeholder="Ara..."
                                    (input)="dt3.filterGlobal($any($event.target).value, 'contains')" />
                            </p-iconfield>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr class="text-sm">
                            <th>ID</th>
                            <th>Tarih</th>
                            <th>Dosya Adı</th>
                            <th class="text-right">Toplam Tutar</th>
                            <th>İstasyon</th>
                            <th>Silme Nedeni</th>
                            <th>Talep Eden</th>
                            <th class="text-center">İşlemler</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-vardiya>
                        <tr class="hover:bg-surface-50 dark:hover:bg-surface-800 transition-colors">
                            <td><span class="text-surface-600">#</span>{{ vardiya.id }}</td>
                            <td>{{ vardiya.baslangicTarihi | date:'dd.MM.yyyy HH:mm' }}</td>
                            <td><span class="font-bold text-surface-800 dark:text-surface-100">{{ vardiya.dosyaAdi
                                    }}</span></td>
                            <td class="text-right"><span class="font-bold text-lg">{{ vardiya.genelToplam |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span></td>
                            <td>{{ vardiya.istasyon?.ad }}</td>
                            <td><span class="text-sm text-surface-600 dark:text-surface-300">{{
                                    vardiya.silinmeTalebiNedeni }}</span></td>
                            <td><span class="text-sm">{{ vardiya.silinmeTalebiOlusturanAdi }}</span></td>
                            <td class="text-center">
                                <button pButton pRipple icon="pi pi-search" label="İncele"
                                    class="p-button-rounded p-button-text p-button-info"
                                    (click)="incele(vardiya)"></button>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="8" class="text-center py-12">
                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-24 h-24 bg-surface-100 dark:bg-surface-800 rounded-full flex items-center justify-center mb-4">
                                        <i class="pi pi-check-circle text-4xl text-green-500"></i>
                                    </div>
                                    <h4 class="text-surface-600 dark:text-surface-300 m-0">Bekleyen silme talebi
                                        bulunmuyor</h4>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </div>
</div>

<!-- Detay Modalı -->
<p-dialog [(visible)]="detayVisible" [modal]="true" [style]="{ width: '90vw' }" [maximizable]="true" [draggable]="false"
    [resizable]="false">

    <ng-template pTemplate="header">
        <div class="flex flex-col justify-center">
            <span class="font-bold text-base md:text-xl text-[var(--text-color)]">
                {{ seciliVardiya?.baslangicTarihi | date:'dd.MM.yyyy' }}
            </span>
            <span class="text-xs md:text-sm text-muted-color">
                {{ seciliVardiya?.baslangicTarihi | date:'HH:mm' }} - {{ seciliVardiya?.bitisTarihi | date:'HH:mm' }}
            </span>
        </div>
    </ng-template>

    <div *ngIf="seciliVardiya && genelOzet" class="flex flex-col gap-6">

        <!-- MOBILE: Horizontal Scroll Summary Cards -->
        <div class="summary-scroll block md:hidden">
            <div class="summary-card blue">
                <div class="summary-icon"><i class="pi pi-chart-line"></i></div>
                <div class="summary-value">{{ pompaciSatisTutar | number:'1.0-0' }}₺</div>
                <div class="summary-label">Pompa Cirosu</div>
            </div>
            <div class="summary-card green">
                <div class="summary-icon"><i class="pi pi-users"></i></div>
                <div class="summary-value">{{ pompaCiroGosterim | number:'1.0-0' }}₺</div>
                <div class="summary-label">Pompacı Satış</div>
            </div>
            <div class="summary-card purple" (click)="openKrediKartiDetay()">
                <div class="summary-icon"><i class="pi pi-credit-card"></i></div>
                <div class="summary-value">{{ toplamKrediKarti | number:'1.0-0' }}₺</div>
                <div class="summary-label">Kredi Kartı</div>
            </div>
            <div class="summary-card orange">
                <div class="summary-icon"><i class="pi pi-wallet"></i></div>
                <div class="summary-value">{{ pompaciNakitToplam | number:'1.0-0' }}₺</div>
                <div class="summary-label">Nakit</div>
            </div>
            <div class="summary-card" [ngClass]="{
                'green': pompaFarkDurumRenk === 'success',
                'orange': pompaFarkDurumRenk === 'warn',
                'red': pompaFarkDurumRenk === 'danger'
            }">
                <div class="summary-icon">
                    <i class="pi" [ngClass]="{
                        'pi-check-circle': pompaFarkDurumRenk === 'success',
                        'pi-exclamation-circle': pompaFarkDurumRenk !== 'success'
                    }"></i>
                </div>
                <div class="summary-value">{{ pompaFark | number:'1.0-0' }}₺</div>
                <div class="summary-label">Fark</div>
            </div>
        </div>

        <!-- DESKTOP: Grid Summary Cards -->
        <div class="hidden md:grid grid-cols-1 md:grid-cols-5 gap-4">
            <div
                class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Pompa Cirosu</span>
                <span class="text-3xl font-bold text-primary">{{ pompaciSatisTutar |
                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
            </div>
            <div
                class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Pompacı
                    Satışları</span>
                <span class="text-3xl font-bold text-green-600">{{ pompaCiroGosterim |
                    currency:'TRY':'symbol-narrow':'1.2-2'
                    }}</span>
            </div>
            <!-- Toplam Kredi Kartı Kartı -->
            <div class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center cursor-pointer hover:bg-surface-50 transition-colors"
                (click)="openKrediKartiDetay()">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Toplam K.
                    Kartı</span>
                <span class="text-3xl font-bold text-blue-600">{{ toplamKrediKarti |
                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                <span class="text-xs text-muted-color mt-1"><i class="pi pi-search mr-1"></i>Detay</span>
            </div>
            <div
                class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Toplam Nakit</span>
                <span class="text-3xl font-bold text-red-500">{{ pompaciNakitToplam |
                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
            </div>
            <div
                class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center bg-gray-50 dark:bg-gray-800">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Fark Durumu</span>
                <div class="flex items-center gap-2">
                    <i class="pi pi-circle-fill text-xs"
                        [ngClass]="{'text-green-500': pompaFarkDurumRenk === 'success', 'text-warning-500': pompaFarkDurumRenk === 'warn', 'text-red-500': pompaFarkDurumRenk === 'danger'}"></i>
                    <span class="text-3xl font-bold"
                        [ngClass]="{'text-green-600': pompaFarkDurumRenk === 'success', 'text-orange-600': pompaFarkDurumRenk === 'warn', 'text-red-600': pompaFarkDurumRenk === 'danger'}">
                        {{ pompaFark | currency:'TRY':'symbol-narrow':'1.2-2' }}
                    </span>
                </div>
            </div>
        </div>

        <p-tabs [(value)]="activeTab">
            <p-tablist>
                <p-tab value="0">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-credit-card"></i>
                        <span class="hidden sm:inline">Tahsilat</span>

                    </div>
                </p-tab>
                <p-tab value="1">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-users"></i>
                        <span class="hidden sm:inline">Personel</span>

                    </div>
                </p-tab>
                <p-tab value="2">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-shopping-cart"></i>
                        <span class="hidden sm:inline">Market</span>

                    </div>
                </p-tab>
                <p-tab value="3">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-wallet"></i>
                        <span class="hidden sm:inline">Giderler</span>

                    </div>
                </p-tab>
                <p-tab value="4">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-database"></i>
                        <span class="hidden sm:inline">Tank</span>

                    </div>
                </p-tab>
            </p-tablist>

            <p-tabpanels>
                <!-- SEKME 1: TAHSİLAT DETAYLARI (Artık İlk) -->
                <p-tabpanel value="0">
                    <!-- MOBILE VIEW: Card-based Layout -->
                    <div class="block md:hidden mt-4">
                        <!-- Tahsilat Özeti Card -->
                        <div class="personel-detay-card mb-4">
                            <div class="personel-detay-header" style="border: none; margin: 0; padding-bottom: 0;">
                                <div class="personel-detay-avatar"
                                    style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);">
                                    <i class="pi pi-wallet" style="color: white;"></i>
                                </div>
                                <span class="personel-detay-name">Tahsilat Özeti</span>
                            </div>
                            <div style="margin-top: 0.75rem;">
                                <div class="personel-detay-grid">
                                    <div class="personel-stat highlight-green">
                                        <div class="personel-stat-label">Nakit</div>
                                        <div class="personel-stat-value">{{ genelOzet.toplamNakit |
                                            currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                    </div>
                                    <div class="personel-stat highlight-blue">
                                        <div class="personel-stat-label">Kredi Kartı</div>
                                        <div class="personel-stat-value">{{ genelOzet.toplamKrediKarti |
                                            currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                    </div>
                                    <!-- Dinamik Kartlar (Mobile) -->
                                    <div *ngFor="let item of genelOzet.digerOdemeler"
                                        class="personel-stat highlight-purple">
                                        <div class="personel-stat-label">{{ item.turAdi }}</div>
                                        <div class="personel-stat-value">{{ item.toplam |
                                            currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                    </div>
                                </div>
                                <div class="fark-badge success full"
                                    style="justify-content: space-between; margin-top: 0.5rem;">
                                    <span>Toplam Tahsilat</span>
                                    <span style="font-size: 1rem;">{{ (genelOzet.toplamNakit +
                                        genelOzet.toplamKrediKarti + digerOdemelerToplamTutar) |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Kredi Kartı Detayları Card -->
                        <div class="personel-detay-card">
                            <div class="personel-detay-header" style="border: none; margin: 0; padding-bottom: 0;">
                                <div class="personel-detay-avatar"
                                    style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                                    <i class="pi pi-credit-card" style="color: white;"></i>
                                </div>
                                <span class="personel-detay-name">Kredi Kartı Detayları</span>
                            </div>
                            <div style="margin-top: 0.75rem;">
                                <div *ngFor="let item of pusulaKrediKartiDetaylari" class="personel-stat full"
                                    style="margin-bottom: 0.5rem;" [ngClass]="{'highlight-blue': item.isSpecial}">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span class="personel-stat-label"
                                            style="text-transform: none; font-size: 0.8rem;">{{ item.banka }}</span>
                                        <span class="personel-stat-value"
                                            [ngClass]="{'color': item.isSpecial ? '#8b5cf6' : '#1e293b'}">
                                            {{ item.tutar | currency:'TRY':'symbol-narrow':'1.2-2' }}
                                        </span>
                                    </div>
                                </div>
                                <div *ngIf="pusulaKrediKartiDetaylari.length === 0"
                                    style="text-align: center; padding: 1rem; color: #94a3b8;">
                                    Kredi kartı detayı bulunamadı
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DESKTOP VIEW: Original Layout -->
                    <div class="hidden md:grid grid-cols-1 md:grid-cols-2 gap-8 mt-4">
                        <!-- Sol: Tahsilat Özeti -->
                        <div class="flex flex-col gap-4">
                            <h3 class="text-lg font-bold border-b pb-2">Tahsilat Özeti</h3>
                            <div class="flex justify-between p-3 bg-surface-50 rounded">
                                <span>Nakit</span>
                                <span class="font-bold">{{ genelOzet.toplamNakit |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <div class="flex justify-between p-3 rounded">
                                <span>Kredi Kartı</span>
                                <span class="font-bold text-blue-600">{{
                                    genelOzet.toplamKrediKarti |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <!-- Dinamik Liste (Desktop) -->
                            <div *ngFor="let item of genelOzet.digerOdemeler"
                                class="flex justify-between p-3 bg-surface-50 rounded">
                                <span>{{ item.turAdi }}</span>
                                <span class="font-bold">{{ item.toplam |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <div class="flex justify-between p-3 bg-green-50 rounded border border-green-100 mt-2">
                                <span class="font-bold text-green-800">Toplam Tahsilat</span>
                                <span class="font-bold text-green-800">{{ (genelOzet.toplamNakit +
                                    genelOzet.toplamKrediKarti + digerOdemelerToplamTutar) |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                        </div>

                        <!-- Sağ: Kredi Kartı Detayları -->
                        <div class="flex flex-col gap-4">
                            <h3 class="text-lg font-bold border-b pb-2">Kredi Kartı Detayları
                            </h3>
                            <p-table [value]="pusulaKrediKartiDetaylari" styleClass="p-datatable-sm p-datatable-striped"
                                [scrollable]="true" scrollHeight="300px">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th>Banka</th>
                                        <th class="text-right">Tutar</th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-item>
                                    <tr
                                        [ngClass]="{'border-t-2 border-dashed border-surface-300 dark:border-surface-600': item.showSeparator}">
                                        <td
                                            [ngClass]="{'font-bold text-[var(--text-color)] dark:text-surface-0': item.isSpecial}">
                                            {{item.banka}}
                                        </td>
                                        <td class="text-right font-bold"
                                            [ngClass]="{'text-purple-600': item.isSpecial}">
                                            {{item.tutar |
                                            currency:'TRY':'symbol-narrow':'1.2-2'}}
                                        </td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="2" class="text-center p-4 text-muted-color">Kredi kartı
                                            detayı
                                            bulunamadı.</td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </div>
                </p-tabpanel>


                <!-- SEKME 2: POMPA & PERSONEL -->
                <p-tabpanel value="1">
                    <!-- MOBILE VIEW: Personel Cards -->
                    <div class="personel-detay-list block md:hidden mt-4">
                        <div *ngFor="let item of farkAnalizi" class="personel-detay-card">
                            <div class="personel-detay-header">
                                <div class="personel-detay-avatar">
                                    <i class="pi pi-user"></i>
                                </div>
                                <span class="personel-detay-name">{{ item.personelAdi }}</span>
                                <p-tag *ngIf="item.farkDurum === 'UYUMLU'" value="Uyumlu" severity="success"
                                    [style]="{fontSize: '0.65rem'}"></p-tag>
                                <p-tag *ngIf="item.farkDurum === 'ACIK'" value="Açık" severity="danger"
                                    [style]="{fontSize: '0.65rem'}"></p-tag>
                                <p-tag *ngIf="item.farkDurum === 'FAZLA'" value="Fazla" severity="warn"
                                    [style]="{fontSize: '0.65rem'}"></p-tag>
                            </div>

                            <div class="personel-detay-grid">
                                <div class="personel-stat highlight-blue">
                                    <div class="personel-stat-label">Otomasyon Satış</div>
                                    <div class="personel-stat-value">{{ item.otomasyonToplam |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                </div>
                                <div class="personel-stat highlight-green">
                                    <div class="personel-stat-label">Pusula Toplam</div>
                                    <div class="personel-stat-value">{{ item.pusulaToplam |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                </div>
                                <div class="personel-stat">
                                    <div class="personel-stat-label">Nakit</div>
                                    <div class="personel-stat-value">{{ item.pusulaDokum.nakit |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                </div>
                                <div class="personel-stat">
                                    <div class="personel-stat-label">Kredi Kartı</div>
                                    <div class="personel-stat-value">{{ item.pusulaDokum.krediKarti |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                </div>
                                <div *ngFor="let odeme of item.pusulaDokum.digerOdemeler" class="personel-stat">
                                    <div class="personel-stat-label">{{ odeme.turAdi }}</div>
                                    <div class="personel-stat-value">{{ odeme.tutar |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                </div>
                            </div>

                            <div class="personel-detay-footer">
                                <span style="font-size: 0.75rem; color: #94a3b8;">Fark:</span>
                                <div class="fark-badge" [ngClass]="{
                                        'success': item.farkDurum === 'UYUMLU',
                                        'danger': item.farkDurum === 'ACIK',
                                        'warn': item.farkDurum === 'FAZLA'
                                    }">
                                    <i class="pi" [ngClass]="{
                                            'pi-check': item.farkDurum === 'UYUMLU',
                                            'pi-arrow-down': item.farkDurum === 'ACIK',
                                            'pi-arrow-up': item.farkDurum === 'FAZLA'
                                        }"></i>
                                    {{ item.fark | currency:'TRY':'symbol-narrow':'1.2-2' }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DESKTOP VIEW: Table -->
                    <div class="hidden md:grid grid-cols-1 mt-4">
                        <p-table [value]="farkAnalizi" styleClass="p-datatable-sm p-datatable-striped"
                            [rowHover]="true">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th>Personel</th>
                                    <th class="text-right">Otomasyon Satış</th>
                                    <th class="text-right">Nakit</th>
                                    <th class="text-right">Kredi Kartı</th>
                                    <th class="text-right">Diğer Ödemeler</th>
                                    <th class="text-right">Pusula Toplam</th>
                                    <th class="text-right">Fark</th>
                                    <th class="text-center">Durum</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-item>
                                <tr>
                                    <td class="font-medium">{{ item.personelAdi }}</td>
                                    <td class="text-right text-muted-color">{{
                                        item.otomasyonToplam |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                                    <td class="text-right">{{ item.pusulaDokum.nakit |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                                    <td class="text-right">{{ item.pusulaDokum.krediKarti |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                                    <td class="text-right">
                                        <div *ngIf="item.pusulaDokum.digerOdemeler?.length > 0">
                                            <div *ngFor="let odeme of item.pusulaDokum.digerOdemeler"
                                                class="flex justify-end gap-1 text-xs">
                                                <span class="font-semibold text-gray-500">{{ odeme.turAdi }}:</span>
                                                <span>{{ odeme.tutar | number:'1.2-2' }}</span>
                                            </div>
                                        </div>
                                        <span *ngIf="!item.pusulaDokum.digerOdemeler?.length"
                                            class="text-gray-300">-</span>
                                    </td>
                                    <td class="text-right font-bold">{{ item.pusulaToplam |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                                    <td class="text-right"
                                        [ngClass]="{'text-red-500': item.fark < -1, 'text-green-500': item.fark > 1}">
                                        {{ item.fark | currency:'TRY':'symbol-narrow':'1.2-2' }}
                                    </td>
                                    <td class="text-center">
                                        <p-tag *ngIf="item.farkDurum === 'UYUMLU'" value="Uyumlu"
                                            severity="success"></p-tag>
                                        <p-tag *ngIf="item.farkDurum === 'ACIK'" value="Açık" severity="danger"></p-tag>
                                        <p-tag *ngIf="item.farkDurum === 'FAZLA'" value="Fazla" severity="warn"></p-tag>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>
                </p-tabpanel>

                <!-- SEKME 3: MARKET -->
                <p-tabpanel value="2">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-4" *ngIf="marketOzet">
                        <div class="flex flex-col gap-4">
                            <h3 class="text-lg font-bold border-b pb-2">Z-Raporu ve Satışlar</h3>
                            <div class="flex justify-between p-3 bg-surface-50 rounded">
                                <span>Z Raporu Toplamı</span>
                                <span class="font-bold">{{ marketOzet.zRaporuToplam |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <div class="flex justify-between p-3 rounded">
                                <span>Toplam KDV</span>
                                <span>{{ marketOzet.kdvDokum.toplam | currency:'TRY':'symbol-narrow':'1.2-2'
                                    }}</span>
                            </div>
                        </div>
                        <div class="flex flex-col gap-4">
                            <h3 class="text-lg font-bold border-b pb-2">Kasa Durumu</h3>
                            <div class="flex justify-between p-3 bg-surface-50 rounded">
                                <span>Toplam Tahsilat (Nakit+KK)</span>
                                <span class="font-bold text-green-600">{{ marketOzet.tahsilatToplam |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <div class="flex justify-between p-3 rounded">
                                <span>Market Giderleri</span>
                                <span class="text-red-500">- {{ marketOzet.giderToplam |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <div class="flex justify-between p-3 bg-blue-50 rounded border border-blue-100">
                                <span class="font-bold text-blue-800">Net Kasa</span>
                                <span class="font-bold text-blue-800">{{ marketOzet.netKasa |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="!marketOzet" class="text-center p-8 text-muted-color">Market verisi bulunamadı.
                    </div>
                </p-tabpanel>

                <!-- SEKME 4: GİDERLER -->
                <p-tabpanel value="3">
                    <div class="mt-4">
                        <p-table
                            [value]="(vardiyaOzet?.pompaOzet?.giderToplam ? [{tutar: vardiyaOzet?.pompaOzet?.giderToplam, tur: 'Pompa Giderleri'}] : [])"
                            styleClass="p-datatable-sm">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th>Gider Türü</th>
                                    <th class="text-right">Tutar</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-gider>
                                <tr>
                                    <td>{{gider.tur}}</td>
                                    <td class="text-right font-bold text-red-500">{{gider.tutar |
                                        currency:'TRY':'symbol-narrow':'1.2-2'}}</td>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="footer">
                                <tr>
                                    <td class="text-right font-bold">Toplam Gider:</td>
                                    <td class="text-right font-bold text-red-600">{{ genelOzet.toplamGider |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>
                </p-tabpanel>

                <!-- SEKME 5: TANK ENVANTER -->
                <p-tabpanel value="4">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
                        <div *ngFor="let tank of tankEnvanter"
                            class="p-4 border rounded-lg bg-white dark:bg-surface-800 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-bold text-lg text-[var(--text-color)]">
                                    Tank {{ tank.tankNo }} - {{ tank.tankAdi }}
                                </h4>
                                <p-tag [value]="tank.yakitTipi"
                                    [severity]="tank.yakitTipi === 'MOTORIN' ? 'info' : (tank.yakitTipi === 'BENZIN' ? 'success' : 'warning')">
                                </p-tag>
                            </div>

                            <div class="space-y-2 text-sm">
                                <div
                                    class="flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-700">
                                    <span class="text-[var(--text-color-secondary)]">Başlangıç Stok:</span>
                                    <span class="font-bold text-[var(--text-color)]">{{ tank.baslangicStok |
                                        number:'1.0-0' }} L</span>
                                </div>

                                <div class="flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-700"
                                    *ngIf="tank.sevkiyatMiktar > 0">
                                    <span class="text-[var(--text-color-secondary)]">Sevkiyat:</span>
                                    <span class="font-bold text-green-600">+{{ tank.sevkiyatMiktar |
                                        number:'1.0-0'
                                        }}
                                        L</span>
                                </div>

                                <div
                                    class="flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-700">
                                    <span class="text-[var(--text-color-secondary)]">Satılan:</span>
                                    <span class="font-bold text-red-600">-{{ tank.satilanMiktar |
                                        number:'1.0-0' }}
                                        L</span>
                                </div>

                                <div
                                    class="flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-700">
                                    <span class="text-[var(--text-color-secondary)]">Bitiş Stok:</span>
                                    <span class="font-bold text-[var(--text-color)]">{{ tank.bitisStok |
                                        number:'1.0-0'
                                        }} L</span>
                                </div>

                                <!-- Fark Gösterimi - Daha Açıklayıcı -->
                                <div class="mt-3 p-3 rounded-lg" [ngClass]="{
                                         'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800': Math.abs(tank.farkMiktar) <= 20,
                                         'bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800': Math.abs(tank.farkMiktar) > 20 && Math.abs(tank.farkMiktar) <= 50,
                                         'bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800': Math.abs(tank.farkMiktar) > 50
                                     }">
                                    <div class="flex items-center justify-between mb-1">
                                        <span class="font-semibold text-sm" [ngClass]="{
                                                  'text-green-700 dark:text-green-400': Math.abs(tank.farkMiktar) <= 20,
                                                  'text-yellow-700 dark:text-yellow-400': Math.abs(tank.farkMiktar) > 20 && Math.abs(tank.farkMiktar) <= 50,
                                                  'text-red-700 dark:text-red-400': Math.abs(tank.farkMiktar) > 50
                                              }">
                                            <i class="pi" [ngClass]="{
                                                   'pi-check-circle': Math.abs(tank.farkMiktar) <= 20,
                                                   'pi-exclamation-triangle': Math.abs(tank.farkMiktar) > 20 && Math.abs(tank.farkMiktar) <= 50,
                                                   'pi-times-circle': Math.abs(tank.farkMiktar) > 50
                                               }"></i>
                                            {{ Math.abs(tank.farkMiktar) <= 20 ? 'Normal' : (Math.abs(tank.farkMiktar)
                                                <=50 ? 'Dikkat' : 'Uyarı' ) }} </span>
                                                <span class="font-bold text-lg" [ngClass]="{
                                                  'text-green-700 dark:text-green-400': Math.abs(tank.farkMiktar) <= 20,
                                                  'text-yellow-700 dark:text-yellow-400': Math.abs(tank.farkMiktar) > 20 && Math.abs(tank.farkMiktar) <= 50,
                                                  'text-red-700 dark:text-red-400': Math.abs(tank.farkMiktar) > 50
                                              }">
                                                    {{ tank.farkMiktar >= 0 ? '+' : '' }}{{ tank.farkMiktar
                                                    |
                                                    number:'1.0-0' }} L
                                                </span>
                                    </div>
                                    <p class="text-xs" [ngClass]="{
                                           'text-green-600 dark:text-green-400': Math.abs(tank.farkMiktar) <= 20,
                                           'text-yellow-600 dark:text-yellow-400': Math.abs(tank.farkMiktar) > 20 && Math.abs(tank.farkMiktar) <= 50,
                                           'text-red-600 dark:text-red-400': Math.abs(tank.farkMiktar) > 50
                                       }">
                                        {{ Math.abs(tank.farkMiktar) <= 20 ? '✓ Tank ölçümleri doğru, kayıp/kaçak yok' :
                                            (Math.abs(tank.farkMiktar) <=50 ? '⚠ Küçük fark tespit edildi' : '⚠ Önemli
                                                fark! Kontrol gerekli' ) }} </p>
                                </div>
                            </div>
                        </div>

                        <div *ngIf="tankEnvanter.length === 0"
                            class="col-span-full text-center py-8 text-[var(--text-color-secondary)]">
                            <i class="pi pi-info-circle text-4xl mb-2"></i>
                            <p>Bu vardiya için tank envanter verisi bulunamadı.</p>
                        </div>
                    </div>
                </p-tabpanel>
            </p-tabpanels>
        </p-tabs>

    </div>

    <ng-template pTemplate="footer">
        <div class="flex justify-center md:justify-between items-center w-full" *ngIf="seciliVardiya">
            <div class="text-sm text-muted-color text-left hidden md:block">
                Onaya gönderen: {{ seciliVardiya.sorumluAdi || 'Sistem' }}<br>
                Tarih: {{ seciliVardiya.guncellemeTarihi | date:'dd.MM.yyyy HH:mm' }}
            </div>
            <div class="flex gap-4 w-full md:w-auto justify-center md:justify-end">
                <p-button label="Reddet" icon="pi pi-times" severity="danger" [outlined]="true" styleClass="px-6"
                    (onClick)="reddetDialogAc(seciliVardiya)"></p-button>
                <p-button label="Onayla" icon="pi pi-check" severity="success" styleClass="px-6"
                    (onClick)="onayla(seciliVardiya)"></p-button>
                <p-button label="Kapat" icon="pi pi-times" severity="secondary" styleClass="px-6"
                    (onClick)="detayVisible = false"></p-button>
            </div>
        </div>
    </ng-template>

</p-dialog>

<!-- Reddetme Dialog -->
<p-dialog header="Vardiya Red İşlemi" [(visible)]="redDialogVisible" [modal]="true" [style]="{width: '450px'}">
    <div class="flex flex-col gap-4">
        <p class="text-muted-color mb-2">Bu mutabakatı reddetmek üzeresiniz. Lütfen aşağıya işlemin nedenini
            açıklayan bir not giriniz.</p>
        <div class="flex flex-col gap-2">
            <label for="neden" class="font-bold">Red Nedeni</label>
            <textarea pInputTextarea id="neden" [(ngModel)]="redNedeni" rows="4" class="w-full"
                placeholder="Örn: Kasa sayımında eksik var, fişler kontrol edilmeli..."></textarea>
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button label="İptal" icon="pi pi-times" [text]="true" (onClick)="redDialogVisible = false"></p-button>
        <p-button label="Reddet" icon="pi pi-check" severity="danger" (onClick)="reddetIslemi()"></p-button>
    </ng-template>
</p-dialog>

<!-- Market Detay Modalı -->
<p-dialog [(visible)]="marketDetayVisible" [modal]="true"
    [header]="'Market Vardiya Detayı: ' + (seciliMarketVardiya?.tarih | date:'dd.MM.yyyy')" [style]="{ width: '70vw' }"
    [maximizable]="true" [draggable]="false" [resizable]="false" [closable]="true" [closeOnEscape]="true">

    <div *ngIf="seciliMarketVardiya && marketOzet" class="flex flex-col gap-6">

        <!-- Üst Bilgi Kartları -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div
                class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Toplam Satış</span>
                <span class="text-3xl font-bold text-primary">{{ marketOzet.zRaporuToplam |
                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
            </div>
            <div
                class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Toplam
                    Tahsilat</span>
                <span class="text-3xl font-bold text-green-600">{{ marketOzet.tahsilatToplam |
                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
            </div>
            <div
                class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Giderler</span>
                <span class="text-3xl font-bold text-red-500">{{ marketOzet.giderToplam |
                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
            </div>
            <div
                class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center bg-gray-50 dark:bg-gray-800">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Net Kasa</span>
                <span class="text-3xl font-bold text-blue-800">{{ marketOzet.netKasa |
                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="flex flex-col gap-4">
                <h3 class="text-lg font-bold border-b pb-2">Z-Raporu Detayları</h3>
                <div class="flex justify-between p-3 bg-surface-50 rounded">
                    <span>Z Raporu No</span>
                    <span class="font-bold">{{ seciliMarketVardiya.zRaporuNo || '-' }}</span>
                </div>
                <div class="flex justify-between p-3 rounded">
                    <span>Toplam KDV</span>
                    <span>{{ marketOzet.kdvDokum.toplam | currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                </div>
            </div>

            <div class="flex flex-col gap-4">
                <h3 class="text-lg font-bold border-b pb-2">Fark Analizi</h3>
                <div class="flex justify-between p-3 bg-surface-50 rounded">
                    <span>Hesaplanan Satış</span>
                    <span class="font-bold">{{ marketOzet.zRaporuToplam | currency:'TRY':'symbol-narrow':'1.2-2'
                        }}</span>
                </div>
                <div class="flex justify-between p-3 rounded">
                    <span>Teslim Edilen</span>
                    <span class="font-bold text-green-600">{{ marketOzet.tahsilatToplam |
                        currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                </div>
                <div class="flex justify-between p-3 bg-blue-50 rounded border border-blue-100">
                    <span class="font-bold text-blue-800">Fark</span>
                    <span class="font-bold"
                        [ngClass]="{'text-red-500': (seciliMarketVardiya.toplamFark || 0) < 0, 'text-blue-500': (seciliMarketVardiya.toplamFark || 0) > 0}">
                        {{ seciliMarketVardiya.toplamFark | currency:'TRY':'symbol-narrow':'1.2-2' }}
                    </span>
                </div>
            </div>
        </div>

        <div class="flex justify-between items-center mt-6 pt-6 border-t border-surface-200">
            <div class="text-sm text-muted-color">
                Onaya gönderen: Sistem<br>
                Tarih: {{ seciliMarketVardiya.tarih | date:'dd.MM.yyyy' }}
            </div>
            <div class="flex gap-3">
                <p-button label="Reddet" icon="pi pi-times" severity="danger" [outlined]="true"
                    (onClick)="marketReddetDialogAc(seciliMarketVardiya)"></p-button>
                <p-button label="Onayla ve Kapat" icon="pi pi-check" severity="success"
                    (onClick)="marketOnayla(seciliMarketVardiya)"></p-button>
            </div>
        </div>
    </div>
</p-dialog>

<!-- Market Reddetme Dialog -->
<p-dialog header="Market Vardiya Red İşlemi" [(visible)]="marketRedDialogVisible" [modal]="true"
    [style]="{width: '450px'}">
    <div class="flex flex-col gap-4">
        <p class="text-muted-color mb-2">Bu market vardiyasını reddetmek üzeresiniz. Lütfen aşağıya işlemin nedenini
            açıklayan bir not giriniz.</p>
        <div class="flex flex-col gap-2">
            <label for="marketRedNeden" class="font-bold">Red Nedeni</label>
            <textarea pInputTextarea id="marketRedNeden" [(ngModel)]="marketRedNedeni" rows="4" class="w-full"
                placeholder="Örn: Kasa sayımında eksik var..."></textarea>
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button label="İptal" icon="pi pi-times" [text]="true" (onClick)="marketRedDialogVisible = false"></p-button>
        <p-button label="Reddet" icon="pi pi-check" severity="danger" (onClick)="marketReddetIslemi()"></p-button>
    </ng-template>
</p-dialog>

<p-confirmdialog></p-confirmdialog>