<p-toast></p-toast>

<!-- MOBILE NATIVE VIEW -->
<div class="vardiya-page block md:hidden">
    <!-- Mobile Native Header -->
    <div class="mobile-page-header">
        <h1 class="page-title">Vardiya Mutabakatı</h1>
        <p class="page-subtitle">Otomasyon dosyalarını yönetin</p>
    </div>

    <!-- Summary Cards -->
    <div class="summary-scroll">
        <div class="summary-card blue" (click)="dosyaDialogAc()">
            <div class="summary-icon"><i class="pi pi-folder-open"></i></div>
            <div class="summary-value">{{ vardiyalar.length }}</div>
            <div class="summary-label">Yüklenen</div>
        </div>
        <div class="summary-card orange">
            <div class="summary-icon"><i class="pi pi-hourglass"></i></div>
            <div class="summary-value">{{ getMutabakatBekleyenSayisi() }}</div>
            <div class="summary-label">Bekleyen</div>
        </div>
        <div class="summary-card green">
            <div class="summary-icon"><i class="pi pi-check-circle"></i></div>
            <div class="summary-value">{{ getTamamlananSayisi() }}</div>
            <div class="summary-label">Tamamlanan</div>
        </div>
        <div class="summary-card purple">
            <div class="summary-icon"><i class="pi pi-wallet"></i></div>
            <div class="summary-value">{{ formatShortNumber(summary.toplamCiro) }}₺</div>
            <div class="summary-label">Toplam</div>
        </div>
    </div>

    <!-- Otomatik Dosyalar Section -->
    <div class="otomatik-section" *ngIf="otomatikDosyalar.length > 0">
        <div class="section-title-bar">
            <div class="section-title">
                <i class="pi pi-bolt text-blue-500"></i>
                Otomatik Dosyalar
                <span class="count-badge">{{ otomatikDosyalar.length }}</span>
            </div>
        </div>
        <div class="otomatik-list">
            <div *ngFor="let file of otomatikDosyalar" class="otomatik-card" (click)="otomatikDosyaIsle(file)">
                <div class="otomatik-icon">
                    <i class="pi pi-file-import"></i>
                </div>
                <div class="otomatik-info">
                    <div class="otomatik-name">{{ file.dosyaAdi }}</div>
                    <div class="otomatik-meta">
                        {{ file.yuklemeTarihi | date:'dd.MM.yyyy HH:mm' }} · {{ file.istasyonAd }}
                    </div>
                </div>
                <div class="otomatik-arrow">
                    <i class="pi pi-arrow-right"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Vardiya Cards Section -->
    <div class="vardiya-section">
        <div class="section-title-bar">
            <div class="section-title">Yüklenen Vardiyalar</div>
        </div>

        <div class="vardiya-list" *ngIf="vardiyalar.length > 0">
            <div *ngFor="let vardiya of vardiyalar" class="vardiya-card">
                <div class="vardiya-header">
                    <div class="file-icon">
                        <i class="pi pi-file"></i>
                    </div>
                    <div class="vardiya-info">
                        <div class="vardiya-name">{{ vardiya.dosyaAdi }}</div>
                        <div class="vardiya-meta">
                            <i class="pi pi-clock"></i>
                            <span>{{ vardiya.yuklemeTarihi | date:'dd.MM.yyyy HH:mm' }}</span>
                        </div>
                    </div>
                    <p-tag [value]="getDurumLabel(vardiya.durum)" [severity]="getDurumSeverity(vardiya.durum)"
                        [style]="{fontSize: '0.65rem'}"></p-tag>
                </div>

                <div class="vardiya-stats">
                    <div class="stat-box">
                        <div class="stat-label">Personel</div>
                        <div class="stat-value">{{ vardiya.personelSayisi }}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">İşlem</div>
                        <div class="stat-value">{{ vardiya.islemSayisi }}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Tutar</div>
                        <div class="stat-value">{{ vardiya.toplamTutar | currency:'TRY':'symbol-narrow':'1.0-0' }}</div>
                    </div>
                </div>

                <div class="vardiya-footer">
                    <div class="vardiya-date" *ngIf="vardiya.baslangicTarih">
                        <span style="font-weight: 600; color: #1e293b;">{{ vardiya.baslangicTarih | date:'dd MMM'
                            }}</span>
                        <span style="color: #94a3b8; margin-left: 0.5rem;">{{ vardiya.baslangicTarih | date:'HH:mm'
                            }}</span>
                    </div>
                    <div class="vardiya-actions">
                        <button *ngIf="vardiya.durum === 'ACIK' || vardiya.durum === 'REDDEDILDI'"
                            class="action-btn success" (click)="mutabakatYap(vardiya)">
                            <i class="pi pi-file-excel"></i>
                        </button>
                        <button
                            *ngIf="vardiya.durum === 'ONAY_BEKLIYOR' || vardiya.durum === 'ONAYLANDI' || vardiya.durum === 'SILINME_ONAYI_BEKLIYOR'"
                            class="action-btn info" (click)="incele(vardiya)">
                            <i class="pi pi-search"></i>
                        </button>
                        <button class="action-btn info" (click)="dosyaIndir(vardiya)">
                            <i class="pi pi-download"></i>
                        </button>
                        <button
                            *ngIf="vardiya.durum !== 'SILINME_ONAYI_BEKLIYOR' && vardiya.durum !== 'SILINDI' && !(userRole !== 'admin' && userRole !== 'patron' && vardiya.durum === 'ONAYLANDI')"
                            class="action-btn danger" (click)="vardiyaSil(vardiya)">
                            <i class="pi pi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="vardiyalar.length === 0" class="empty-state">
            <div class="empty-icon">
                <i class="pi pi-upload"></i>
            </div>
            <div class="empty-title">Henüz vardiya verisi yok</div>
            <div class="empty-text">Otomasyon TXT dosyasını yükleyerek başlayın</div>
            <button class="empty-btn" (click)="dosyaDialogAc()">
                <i class="pi pi-upload"></i>
                <span>Dosya Yükle</span>
            </button>
        </div>
    </div>

    <!-- FAB Upload Button -->
    <button class="fab-upload" (click)="dosyaDialogAc()">
        <i class="pi pi-plus"></i>
    </button>
</div>

<!-- DESKTOP VIEW -->
<div class="grid grid-cols-12 gap-6 hidden md:grid">
    <!-- Başlık -->
    <div class="col-span-12">
        <div class="card">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-surface-800 dark:text-surface-100 m-0">
                        <i class="pi pi-list mr-2 text-blue-500"></i>Vardiya Mutabakatı
                    </h2>
                    <p class="text-surface-500 mt-2">
                        Otomasyon TXT dosyasını yükleyin ve mutabakat işlemini gerçekleştirin
                    </p>
                </div>

            </div>
        </div>
    </div>

    <!-- Özet Kartları -->
    <div class="col-span-12 md:col-span-6 lg:col-span-3">
        <div class="p-4 rounded-xl h-full cursor-pointer transition-all duration-300 hover:scale-105"
            style="background: linear-gradient(135deg, #6366f1 0%, #3b82f6 50%, #2563eb 100%); box-shadow: 0 10px 40px rgba(59, 130, 246, 0.3);"
            (click)="dosyaDialogAc()">
            <div class="flex justify-between items-start mb-4">
                <div class="w-14 h-14 rounded-2xl flex items-center justify-center"
                    style="background: rgba(255,255,255,0.2);">
                    <i class="pi pi-folder-open text-2xl" style="color: white;"></i>
                </div>
                <div class="text-right">
                    <span class="text-xs uppercase tracking-wider" style="color: rgba(255,255,255,0.7);">Yüklenen</span>
                    <h3 class="text-4xl font-bold m-0" style="color: white !important;">{{ vardiyalar.length }}</h3>
                </div>
            </div>
            <div class="pt-3 mt-3" style="border-top: 1px solid rgba(255,255,255,0.2);">
                <div class="flex items-center gap-2">
                    <i class="pi pi-plus-circle text-sm" style="color: rgba(255,255,255,0.7);"></i>
                    <span class="text-sm" style="color: rgba(255,255,255,0.9);">Yeni dosya yüklemek için tıklayın</span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-span-12 md:col-span-6 lg:col-span-3">
        <div class="p-4 rounded-xl h-full transition-all duration-300 hover:scale-105"
            style="background: linear-gradient(135deg, #f59e0b 0%, #f97316 50%, #ea580c 100%); box-shadow: 0 10px 40px rgba(249, 115, 22, 0.3);">
            <div class="flex justify-between items-start mb-4">
                <div class="w-14 h-14 rounded-2xl flex items-center justify-center"
                    style="background: rgba(255,255,255,0.2);">
                    <i class="pi pi-hourglass text-2xl" style="color: white;"></i>
                </div>
                <div class="text-right">
                    <span class="text-xs uppercase tracking-wider" style="color: rgba(255,255,255,0.7);">Bekleyen</span>
                    <h3 class="text-4xl font-bold m-0" style="color: white !important;">{{ getMutabakatBekleyenSayisi()
                        }}</h3>
                </div>
            </div>
            <div class="pt-3 mt-3" style="border-top: 1px solid rgba(255,255,255,0.2);">
                <div class="flex items-center gap-2">
                    <i class="pi pi-exclamation-triangle text-sm" style="color: #fef08a;"></i>
                    <span class="text-sm" style="color: rgba(255,255,255,0.9);">
                        {{ getMutabakatBekleyenSayisi() > 0 ? 'Mutabakat işlemi bekliyor!' : 'Tüm işlemler tamam' }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-span-12 md:col-span-6 lg:col-span-3">
        <div class="p-4 rounded-xl h-full transition-all duration-300 hover:scale-105"
            style="background: linear-gradient(135deg, #10b981 0%, #22c55e 50%, #16a34a 100%); box-shadow: 0 10px 40px rgba(34, 197, 94, 0.3);">
            <div class="flex justify-between items-start mb-4">
                <div class="w-14 h-14 rounded-2xl flex items-center justify-center"
                    style="background: rgba(255,255,255,0.2);">
                    <i class="pi pi-check-circle text-2xl" style="color: white;"></i>
                </div>
                <div class="text-right">
                    <span class="text-xs uppercase tracking-wider"
                        style="color: rgba(255,255,255,0.7);">Tamamlanan</span>
                    <h3 class="text-4xl font-bold m-0" style="color: white !important;">{{ getTamamlananSayisi() }}</h3>
                </div>
            </div>
            <div class="pt-3 mt-3" style="border-top: 1px solid rgba(255,255,255,0.2);">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm" style="color: rgba(255,255,255,0.9);">Başarı Oranı</span>
                    <span class="font-bold text-lg" style="color: white !important;">{{ getBasariOrani() }}%</span>
                </div>
                <div class="w-full rounded-full h-2" style="background: rgba(255,255,255,0.2);">
                    <div class="rounded-full h-2 transition-all" style="background: white;"
                        [style.width.%]="getBasariOrani()"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-span-12 md:col-span-6 lg:col-span-3">
        <div class="p-4 rounded-xl h-full transition-all duration-300 hover:scale-105"
            style="background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 50%, #9333ea 100%); box-shadow: 0 10px 40px rgba(168, 85, 247, 0.3);">
            <div class="flex justify-between items-start mb-4">
                <div class="w-14 h-14 rounded-2xl flex items-center justify-center"
                    style="background: rgba(255,255,255,0.2);">
                    <i class="pi pi-wallet text-2xl" style="color: white;"></i>
                </div>
                <div class="text-right">
                    <span class="text-xs uppercase tracking-wider" style="color: rgba(255,255,255,0.7);">Toplam
                        Ciro</span>
                    <h3 class="text-3xl font-bold m-0" style="color: white !important;">
                        {{ formatShortNumber(summary.toplamCiro) }} ₺
                    </h3>
                </div>
            </div>
            <div class="pt-3 mt-3" style="border-top: 1px solid rgba(255,255,255,0.2);">
                <div class="flex items-center gap-4 text-sm">
                    <div class="flex items-center gap-1">
                        <i class="pi pi-receipt" style="color: rgba(255,255,255,0.7);"></i>
                        <span style="color: rgba(255,255,255,0.9);">{{ formatShortNumber(summary.toplamIslem) }}
                            işlem</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <i class="pi pi-users" style="color: rgba(255,255,255,0.7);"></i>
                        <span style="color: rgba(255,255,255,0.9);">{{ summary.benzersizPersonelSayisi }}
                            personel</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Otomatik Gelen Dosyalar (Kapalı Sistem) -->
    <div class="col-span-12" *ngIf="otomatikDosyalar.length > 0">
        <div class="card border-2 border-blue-100 dark:border-blue-900 bg-blue-50/30 dark:bg-blue-900/10">
            <div class="flex justify-between items-center mb-4">
                <h5 class="font-bold m-0 flex items-center gap-2 text-blue-700 dark:text-blue-300">
                    <i class="pi pi-bolt text-blue-500"></i>
                    Otomatik Gelen Dosyalar (İstasyon Bazlı)
                    <p-tag [value]="otomatikDosyalar.length.toString()" severity="info" styleClass="ml-2"></p-tag>
                </h5>
                <span class="text-xs text-blue-600 dark:text-blue-400 italic">
                    <i class="pi pi-shield mr-1"></i> Bu dosyalar sistem tarafından otomatik olarak aktarılmıştır ve
                    müdahale edilmemiştir.
                </span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div *ngFor="let file of otomatikDosyalar"
                    class="p-4 rounded-xl border border-blue-200 dark:border-blue-800 bg-white dark:bg-surface-900 shadow-sm hover:shadow-md transition-all cursor-pointer group"
                    (click)="otomatikDosyaIsle(file)">
                    <div class="flex items-center gap-4">
                        <div
                            class="w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center group-hover:bg-blue-500 transition-colors">
                            <i class="pi pi-file-import text-blue-600 dark:text-blue-400 group-hover:text-white"></i>
                        </div>
                        <div class="flex-1 overflow-hidden">
                            <p class="font-bold m-0 text-surface-800 dark:text-surface-100 truncate">{{ file.dosyaAdi }}
                            </p>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-xs text-surface-500">{{ file.yuklemeTarihi | date:'dd.MM.yyyy HH:mm'
                                    }}</span>
                                <span
                                    class="text-xs px-1.5 py-0.5 rounded bg-blue-100/50 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300 font-medium border border-blue-200/50 dark:border-blue-800/50">
                                    <i class="pi pi-map-marker mr-1 text-[10px]"></i>{{ file.istasyonAd }}
                                </span>
                            </div>





                        </div>
                        <button pButton icon="pi pi-arrow-right"
                            class="p-button-rounded p-button-text p-button-sm"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Vardiya Listesi -->
    <div class="col-span-12">
        <div class="card">
            <div class="flex justify-between items-center mb-4">
                <h5 class="font-bold m-0 flex items-center gap-2">
                    <i class="pi pi-list text-blue-500"></i>
                    Yüklenen Vardiyalar
                </h5>
                <p-button label="Yeni Dosya Yükle" icon="pi pi-upload" severity="primary" (onClick)="dosyaDialogAc()">
                </p-button>
            </div>

            <p-table [value]="vardiyalar" [paginator]="vardiyalar.length > 10" [rows]="10"
                styleClass="p-datatable-striped">

                <ng-template pTemplate="header">
                    <tr class="text-sm">
                        <th class="font-bold">Dosya Bilgisi</th>
                        <th class="font-bold">Vardiya Saati</th>
                        <th class="font-bold text-center">Personel</th>
                        <th class="font-bold text-center">İşlem</th>
                        <th class="font-bold text-right">Toplam Tutar</th>
                        <th class="font-bold text-center">Durum</th>
                        <th></th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-vardiya>
                    <tr class="hover:bg-surface-50 dark:hover:bg-surface-800 transition-colors">
                        <td>
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-xl flex items-center justify-center"
                                    style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                                    <i class="pi pi-file text-white text-lg"></i>
                                </div>
                                <div>
                                    <p class="font-bold m-0 text-surface-800 dark:text-surface-100">
                                        {{ vardiya.dosyaAdi
                                        }}</p>
                                    <p class="text-surface-500 text-xs m-0 flex items-center gap-1">
                                        <i class="pi pi-clock text-xs"></i>
                                        {{ vardiya.yuklemeTarihi | date:'dd.MM.yyyy HH:mm' }}
                                    </p>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div *ngIf="vardiya.baslangicTarih" class="flex flex-col">
                                <span class="font-bold text-surface-800 dark:text-surface-100">{{
                                    vardiya.baslangicTarih
                                    | date:'dd MMMM yyyy':'':'tr' }}</span>
                                <span class="text-sm flex items-center gap-1" style="color: #6366f1;">
                                    <i class="pi pi-clock text-xs"></i>
                                    {{ vardiya.baslangicTarih | date:'HH:mm' }} - {{
                                    vardiya.bitisTarih | date:'HH:mm'
                                    }}
                                </span>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="inline-flex items-center gap-2 px-3 py-2 rounded-lg"
                                style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);">
                                <i class="pi pi-users" style="color: #22c55e;"></i>
                                <span class="font-bold" style="color: #16a34a;">{{
                                    vardiya.personelSayisi }}</span>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="inline-flex items-center gap-2 px-3 py-2 rounded-lg"
                                style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
                                <i class="pi pi-receipt" style="color: #f59e0b;"></i>
                                <span class="font-bold" style="color: #d97706;">{{
                                    vardiya.islemSayisi }}</span>
                            </div>
                        </td>
                        <td class="text-right">
                            <div class="inline-block px-4 py-2 rounded-xl"
                                style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);">
                                <span class="font-bold text-lg text-white">{{
                                    vardiya.toplamTutar |
                                    currency:'TRY':'symbol-narrow':'1.2-2':'tr'
                                    }}</span>
                            </div>
                        </td>
                        <td class="text-center">
                            <p-tag [value]="getDurumLabel(vardiya.durum)" [severity]="getDurumSeverity(vardiya.durum)"
                                styleClass="text-sm px-3 py-1 cursor-pointer"
                                [pTooltip]="vardiya.durum === 'REDDEDILDI' ? vardiya.redNedeni : undefined"
                                tooltipPosition="bottom">
                            </p-tag>
                        </td>
                        <td>
                            <div class="flex gap-2 justify-end">
                                <button pButton pRipple icon="pi pi-file-excel"
                                    class="p-button-rounded p-button-success p-button-text mr-2"
                                    (click)="mutabakatYap(vardiya)"
                                    [pTooltip]="vardiya.durum === 'REDDEDILDI' ? 'Mutabakatı Düzenle' : 'Mutabakat Başlat'"
                                    tooltipPosition="top"
                                    *ngIf="vardiya.durum === 'ACIK' || vardiya.durum === 'REDDEDILDI'"></button>
                                <button pButton pRipple icon="pi pi-download"
                                    class="p-button-rounded p-button-info p-button-text mr-2"
                                    (click)="dosyaIndir(vardiya)" pTooltip="Dosyayı İndir"
                                    tooltipPosition="top"></button>
                                <button pButton pRipple icon="pi pi-search"
                                    class="p-button-rounded p-button-info p-button-text mr-2" (click)='incele(vardiya)'
                                    pTooltip="İncele" tooltipPosition="top"
                                    *ngIf="vardiya.durum === 'ONAY_BEKLIYOR' || vardiya.durum === 'ONAYLANDI' || vardiya.durum === 'SILINME_ONAYI_BEKLIYOR'"></button>
                                <button pButton pRipple icon="pi pi-trash"
                                    class="p-button-rounded p-button-danger p-button-text" (click)="vardiyaSil(vardiya)"
                                    pTooltip="Sil" tooltipPosition="top"
                                    *ngIf="vardiya.durum !== 'SILINME_ONAYI_BEKLIYOR' && vardiya.durum !== 'SILINDI' && !(userRole !== 'admin' && userRole !== 'patron' && vardiya.durum === 'ONAYLANDI')"></button>
                            </div>
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="7" class="text-center py-12">
                            <div class="flex flex-col items-center">
                                <div
                                    class="w-24 h-24 bg-surface-100 dark:bg-surface-800 rounded-full flex items-center justify-center mb-4">
                                    <i class="pi pi-upload text-4xl text-surface-400"></i>
                                </div>
                                <h4 class="text-surface-600 dark:text-surface-300 m-0">Henüz
                                    vardiya verisi yok</h4>
                                <p class="text-surface-400 text-sm m-0 mt-2">
                                    Otomasyon TXT dosyasını yükleyerek başlayın
                                </p>
                                <p-button label="Dosya Yükle" icon="pi pi-upload" severity="success" styleClass="mt-4"
                                    (onClick)="dosyaDialogAc()">
                                </p-button>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>

<!-- Dosya Yükleme Dialog -->
<p-dialog [header]="isAutomaticFile ? 'Otomatik Veriyi İşle' : 'Otomasyon Verisi Yükle'"
    [(visible)]="dosyaDialogVisible" [modal]="true" [style]="{width: '600px'}">

    <div class="flex flex-col gap-4">
        <!-- Otomatik Dosya Bilgi Banner -->
        <div *ngIf="isAutomaticFile" class="p-4 rounded-xl bg-blue-600 text-white shadow-lg mb-2">
            <div class="flex items-center gap-3">
                <i class="pi pi-shield text-2xl"></i>
                <div>
                    <p class="font-bold m-0 text-lg">Güvenli Otomatik Aktarım</p>
                    <p class="text-xs m-0 opacity-90">Bu veri istasyondan doğrudan gelmiştir.
                        İçerik bütünlüğü
                        doğrulanmıştır.</p>
                </div>
            </div>
        </div>

        <!-- Dosya Seçme -->
        <div *ngIf="!isAutomaticFile"
            class="border-2 border-dashed border-surface-300 dark:border-surface-600 rounded-xl p-8 text-center"
            [ngClass]="{'border-green-500 bg-green-50': secilenDosya}">

            <input type="file" accept=".txt,.d1a,.d1b,.d1c,.d1d,.d1e,.d1f,.D1A,.D1B,.D1C,.D1D,.D1E,.D1F"
                (change)="dosyaSec($event)" #fileInput class="hidden">

            <div *ngIf="!secilenDosya">
                <i class="pi pi-cloud-upload text-5xl text-surface-400 mb-4"></i>
                <p class="text-surface-600 dark:text-surface-300 font-semibold m-0">
                    Otomasyon dosyasını sürükleyin veya seçin
                </p>
                <p class="text-surface-400 text-sm m-0 mt-1">
                    Desteklenen uzantılar: .D1A, .D1B, .D1C, .TXT
                </p>
                <p-button label="Dosya Seç" icon="pi pi-folder-open" severity="secondary" styleClass="mt-4"
                    (onClick)="fileInput.click()">
                </p-button>
            </div>

            <div *ngIf="secilenDosya" class="text-green-700 dark:text-green-300">
                <i class="pi pi-file text-5xl mb-4"></i>
                <p class="font-semibold m-0">{{ secilenDosya.name }}</p>
                <p class="text-sm m-0 mt-1">{{ (secilenDosya.size / 1024).toFixed(1) }} KB</p>
                <p-button label="Değiştir" icon="pi pi-refresh" severity="secondary" size="small" styleClass="mt-3"
                    (onClick)="fileInput.click()">
                </p-button>
            </div>
        </div>

        <!-- Parse Sonucu -->
        <div *ngIf="parseSonuc" class="p-4 rounded-lg"
            [ngClass]="parseSonuc.basarili ? 'bg-green-50 dark:bg-green-900/20' : 'bg-red-50 dark:bg-red-900/20'">

            <div *ngIf="parseSonuc.basarili" class="text-green-700 dark:text-green-300">
                <div class="flex items-center gap-2 mb-3">
                    <i class="pi pi-check-circle text-xl"></i>
                    <span class="font-semibold">Dosya başarıyla okundu!</span>
                </div>
                <div class="grid grid-cols-2 gap-3 text-sm">
                    <div class="flex justify-between">
                        <span>Kayıt Sayısı:</span>
                        <span class="font-bold">{{ parseSonuc.kayitSayisi }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Personel:</span>
                        <span class="font-bold">{{ parseSonuc.personeller.length }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Toplam Tutar:</span>
                        <span class="font-bold">{{ parseSonuc.toplamTutar |
                            currency:'TRY':'symbol-narrow':'1.2-2':'tr'
                            }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Tarih:</span>
                        <span class="font-bold">{{ parseSonuc.baslangicTarih | date:'dd.MM.yyyy'
                            }}</span>
                    </div>
                </div>
                <div class="mt-3 pt-3 border-t border-green-300 dark:border-green-700">
                    <p class="text-xs m-0">
                        <strong>Personeller:</strong> {{ parseSonuc.personeller.join(', ') }}
                    </p>
                </div>
            </div>

            <div *ngIf="!parseSonuc.basarili" class="text-red-700 dark:text-red-300">
                <div class="flex items-center gap-2">
                    <i class="pi pi-times-circle text-xl"></i>
                    <span class="font-semibold">Dosya okunamadı!</span>
                </div>
                <p class="text-sm m-0 mt-2">Lütfen geçerli bir otomasyon TXT dosyası yükleyin.
                </p>
            </div>
        </div>

        <!-- İşlem Progress -->
        <div *ngIf="yukleniyor" class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
            <div class="flex items-center gap-3 mb-3">
                <i class="pi pi-spin pi-spinner text-2xl text-blue-500"></i>
                <div>
                    <p class="font-semibold text-blue-700 dark:text-blue-300 m-0">Dosya
                        İşleniyor...</p>
                    <p class="text-blue-600 dark:text-blue-400 text-sm m-0">{{ islemDurumu }}
                    </p>
                </div>
            </div>
            <p-progressBar [value]="islemYuzdesi" [showValue]="true" [style]="{'height': '8px'}"></p-progressBar>
            <div class="flex justify-between text-xs text-blue-500 mt-2">
                <span>{{ bulunanKayit }} kayıt bulundu</span>
                <span>{{ gecenSure }}s</span>
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <p-button label="İptal" icon="pi pi-times" severity="secondary" (onClick)="dosyaDialogKapat()"></p-button>
        <p-button label="Yükle ve Devam Et" icon="pi pi-check" severity="success"
            [disabled]="!parseSonuc?.basarili || yukleniyor" (onClick)="dosyaYukle()">
        </p-button>
    </ng-template>
</p-dialog><!-- Silme Talebi Dialog -->
<p-dialog header="Vardiya Silme Talebi" [(visible)]="silmeTalebiDialogVisible" [modal]="true"
    [style]="{width: '500px'}">
    <div class="flex flex-col gap-4">
        <p class="text-surface-600 dark:text-surface-300">
            <strong>{{ secilenVardiya?.dosyaAdi }}</strong> dosyasını silmek istediğinize emin
            misiniz?
        </p>
        <p class="text-sm text-surface-500">
            Bu işlem onaya gönderilecek ve patron/admin onayından sonra vardiya silinmiş olarak
            işaretlenecektir.
        </p>
        <div class="flex flex-col gap-2">
            <label for="silmeNedeni" class="font-bold">Silme Nedeni <span class="text-red-500">*</span></label>
            <textarea id="silmeNedeni" [(ngModel)]="silmeNedeni" rows="4"
                class="w-full p-3 border border-surface-300 dark:border-surface-600 rounded-lg"
                placeholder="Örn: Yanlış dosya yüklendi, tekrar yüklenecek..." [required]="true">
            </textarea>
            <small class="text-surface-500">En az 10 karakter giriniz</small>
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button label="İptal" icon="pi pi-times" [text]="true" (onClick)="silmeTalebiDialogKapat()"></p-button>
        <p-button label="Silme Talebini Gönder" icon="pi pi-send" severity="danger"
            [disabled]="!silmeNedeni || silmeNedeni.trim().length < 10" (onClick)="silmeTalebiGonder()">
        </p-button>
    </ng-template>
</p-dialog>

<!-- Detay Modalı -->
<p-dialog [(visible)]="detayVisible" [modal]="true" [header]="'Mutabakat Özeti: ' + seciliVardiyaDetay?.dosyaAdi"
    [style]="{ width: '90vw' }" [maximizable]="true" [draggable]="false" [resizable]="false">

    <div *ngIf="seciliVardiyaDetay && genelOzet" class="flex flex-col gap-6">

        <!-- MOBILE: Horizontal Scroll Summary Cards -->
        <div class="summary-scroll block md:hidden">
            <div class="summary-card blue">
                <div class="summary-icon"><i class="pi pi-chart-line"></i></div>
                <div class="summary-value">{{ genelOzet.pompaToplam | number:'1.0-0' }}₺</div>
                <div class="summary-label">Pompa Cirosu</div>
            </div>
            <div class="summary-card green">
                <div class="summary-icon"><i class="pi pi-users"></i></div>
                <div class="summary-value">{{ pompaciSatisTutar | number:'1.0-0' }}₺</div>
                <div class="summary-label">Pompacı Satış</div>
            </div>
            <div class="summary-card purple" (click)="openKrediKartiDetay()">
                <div class="summary-icon"><i class="pi pi-credit-card"></i></div>
                <div class="summary-value">{{ toplamKrediKarti | number:'1.0-0' }}₺</div>
                <div class="summary-label">Kredi Kartı</div>
            </div>
            <div class="summary-card orange">
                <div class="summary-icon"><i class="pi pi-money-bill"></i></div>
                <div class="summary-value">{{ pompaciNakitToplam | number:'1.0-0' }}₺</div>
                <div class="summary-label">Nakit</div>
            </div>
            <div class="summary-card" [ngClass]="{
                'green': pompaFarkDurumRenk === 'success',
                'orange': pompaFarkDurumRenk === 'warn',
                'red': pompaFarkDurumRenk === 'danger'
            }">
                <div class="summary-icon">
                    <i class="pi" [ngClass]="{
                        'pi-check-circle': pompaFarkDurumRenk === 'success',
                        'pi-exclamation-circle': pompaFarkDurumRenk !== 'success'
                    }"></i>
                </div>
                <div class="summary-value">{{ pompaFark | number:'1.0-0' }}₺</div>
                <div class="summary-label">Fark</div>
            </div>
        </div>

        <!-- DESKTOP: Grid Summary Cards -->
        <div class="hidden md:grid grid-cols-1 md:grid-cols-5 gap-4">
            <div
                class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Pompa
                    Cirosu</span>
                <span class="text-3xl font-bold text-primary">{{ genelOzet.pompaToplam |
                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
            </div>
            <div
                class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Pompacı
                    Satışları</span>
                <span class="text-3xl font-bold text-green-600">{{ pompaciSatisTutar |
                    currency:'TRY':'symbol-narrow':'1.2-2'
                    }}</span>
            </div>
            <!-- Toplam Kredi Kartı Kartı -->
            <div class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center cursor-pointer hover:bg-surface-50 transition-colors"
                (click)="openKrediKartiDetay()">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Toplam
                    K.
                    Kartı</span>
                <span class="text-3xl font-bold text-blue-600">{{ toplamKrediKarti |
                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                <span class="text-xs text-muted-color mt-1"><i class="pi pi-search mr-1"></i>Detay</span>
            </div>
            <div
                class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Toplam
                    Nakit</span>
                <span class="text-3xl font-bold text-red-500">{{ pompaciNakitToplam |
                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
            </div>
            <div
                class="surface-card p-4 shadow-sm border border-surface-200 rounded-xl flex flex-col items-center justify-center text-center bg-gray-50 dark:bg-gray-800">
                <span class="text-sm text-muted-color font-medium uppercase tracking-wide mb-2">Fark
                    Durumu</span>
                <div class="flex items-center gap-2">
                    <i class="pi pi-circle-fill text-xs"
                        [ngClass]="{'text-green-500': pompaFarkDurumRenk === 'success', 'text-warning-500': pompaFarkDurumRenk === 'warn', 'text-red-500': pompaFarkDurumRenk === 'danger'}"></i>
                    <span class="text-3xl font-bold"
                        [ngClass]="{'text-green-600': pompaFarkDurumRenk === 'success', 'text-orange-600': pompaFarkDurumRenk === 'warn', 'text-red-600': pompaFarkDurumRenk === 'danger'}">
                        {{ pompaFark | currency:'TRY':'symbol-narrow':'1.2-2' }}
                    </span>
                </div>
            </div>
        </div>

        <p-tabs [(value)]="activeTab">
            <p-tablist>
                <p-tab value="0">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-users"></i>
                        <span>Pompa & Personel</span>
                    </div>
                </p-tab>
                <p-tab value="1">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-credit-card"></i>
                        <span>Tahsilat Detayları</span>
                    </div>
                </p-tab>
                <p-tab value="2">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-shopping-cart"></i>
                        <span>Market</span>
                    </div>
                </p-tab>
            </p-tablist>

            <p-tabpanels>
                <!-- SEKME 1: POMPA & PERSONEL -->
                <p-tabpanel value="0">
                    <!-- MOBILE VIEW: Personel Cards -->
                    <div class="personel-detay-list block md:hidden mt-4">
                        <div *ngFor="let item of farkAnalizi" class="personel-detay-card">
                            <div class="personel-detay-header">
                                <div class="personel-detay-avatar">
                                    <i class="pi pi-user"></i>
                                </div>
                                <span class="personel-detay-name">{{ item.personelAdi }}</span>
                                <p-tag *ngIf="item.farkDurum === 'UYUMLU'" value="Uyumlu" severity="success"
                                    [style]="{fontSize: '0.65rem'}"></p-tag>
                                <p-tag *ngIf="item.farkDurum === 'ACIK'" value="Açık" severity="danger"
                                    [style]="{fontSize: '0.65rem'}"></p-tag>
                                <p-tag *ngIf="item.farkDurum === 'FAZLA'" value="Fazla" severity="warn"
                                    [style]="{fontSize: '0.65rem'}"></p-tag>
                            </div>

                            <div class="personel-detay-grid">
                                <!-- Otomasyon Satış -->
                                <div class="personel-stat highlight-blue">
                                    <div class="personel-stat-label">Otomasyon Satış</div>
                                    <div class="personel-stat-value">{{ item.otomasyonToplam |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                </div>
                                <!-- Pusula Toplam -->
                                <div class="personel-stat highlight-green">
                                    <div class="personel-stat-label">Pusula Toplam</div>
                                    <div class="personel-stat-value">{{ item.pusulaToplam |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                </div>
                                <!-- Nakit -->
                                <div class="personel-stat">
                                    <div class="personel-stat-label">Nakit</div>
                                    <div class="personel-stat-value">{{ item.pusulaDokum?.nakit |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                </div>
                                <!-- Kredi Kartı -->
                                <div class="personel-stat">
                                    <div class="personel-stat-label">Kredi Kartı</div>
                                    <div class="personel-stat-value">{{ item.pusulaDokum?.krediKarti |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                </div>
                                <!-- Paro Puan -->
                                <div class="personel-stat">
                                    <div class="personel-stat-label">Paro Puan</div>
                                    <div class="personel-stat-value">{{ item.pusulaDokum?.paroPuan |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                </div>
                                <!-- Mobil Ödeme -->
                                <div class="personel-stat">
                                    <div class="personel-stat-label">Mobil Ödeme</div>
                                    <div class="personel-stat-value">{{ item.pusulaDokum?.mobilOdeme |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                </div>
                            </div>

                            <div class="personel-detay-footer">
                                <span style="font-size: 0.75rem; color: #94a3b8;">Fark:</span>
                                <div class="fark-badge" [ngClass]="{
                                    'success': item.farkDurum === 'UYUMLU',
                                    'danger': item.farkDurum === 'ACIK',
                                    'warn': item.farkDurum === 'FAZLA'
                                }">
                                    <i class="pi" [ngClass]="{
                                        'pi-check': item.farkDurum === 'UYUMLU',
                                        'pi-arrow-down': item.farkDurum === 'ACIK',
                                        'pi-arrow-up': item.farkDurum === 'FAZLA'
                                    }"></i>
                                    {{ item.fark | currency:'TRY':'symbol-narrow':'1.2-2' }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DESKTOP VIEW: Table -->
                    <div class="hidden md:grid grid-cols-1 mt-4">
                        <p-table [value]="farkAnalizi" styleClass="p-datatable-sm p-datatable-striped"
                            [rowHover]="true">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th>Personel</th>
                                    <th class="text-right">Otomasyon Satış</th>
                                    <th class="text-right">Nakit</th>
                                    <th class="text-right">Kredi Kartı</th>
                                    <th class="text-right">Paro Puan</th>
                                    <th class="text-right">Mobil Ödeme</th>
                                    <th class="text-right">Pusula Toplam</th>
                                    <th class="text-right">Fark</th>
                                    <th class="text-center">Durum</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-item>
                                <tr>
                                    <td class="font-medium">{{ item.personelAdi }}</td>
                                    <td class="text-right text-muted-color">{{
                                        item.otomasyonToplam |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                                    <td class="text-right">{{ item.pusulaDokum?.nakit |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                                    <td class="text-right">{{ item.pusulaDokum?.krediKarti |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                                    <td class="text-right">{{ item.pusulaDokum?.paroPuan |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                                    <td class="text-right">{{ item.pusulaDokum?.mobilOdeme |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                                    <td class="text-right font-bold">{{ item.pusulaToplam |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</td>
                                    <td class="text-right"
                                        [ngClass]="{'text-red-500': item.fark < -1, 'text-green-500': item.fark > 1}">
                                        {{ item.fark | currency:'TRY':'symbol-narrow':'1.2-2' }}
                                    </td>
                                    <td class="text-center">
                                        <p-tag *ngIf="item.farkDurum === 'UYUMLU'" value="Uyumlu"
                                            severity="success"></p-tag>
                                        <p-tag *ngIf="item.farkDurum === 'ACIK'" value="Açık" severity="danger"></p-tag>
                                        <p-tag *ngIf="item.farkDurum === 'FAZLA'" value="Fazla" severity="warn"></p-tag>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>
                </p-tabpanel>
                <p-tabpanel value="1">
                    <!-- MOBILE VIEW: Card-based Layout -->
                    <div class="block md:hidden mt-4">
                        <!-- Tahsilat Özeti Card -->
                        <div class="personel-detay-card mb-4">
                            <div class="personel-detay-header" style="border: none; margin: 0; padding-bottom: 0;">
                                <div class="personel-detay-avatar"
                                    style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);">
                                    <i class="pi pi-wallet" style="color: white;"></i>
                                </div>
                                <span class="personel-detay-name">Tahsilat Özeti</span>
                            </div>
                            <div style="margin-top: 0.75rem;">
                                <div class="personel-detay-grid">
                                    <div class="personel-stat highlight-green">
                                        <div class="personel-stat-label">Nakit</div>
                                        <div class="personel-stat-value">{{ genelOzet.toplamNakit |
                                            currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                    </div>
                                    <div class="personel-stat highlight-blue">
                                        <div class="personel-stat-label">Kredi Kartı</div>
                                        <div class="personel-stat-value">{{ genelOzet.toplamKrediKarti |
                                            currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                    </div>
                                    <div class="personel-stat highlight-orange">
                                        <div class="personel-stat-label">Paro Puan</div>
                                        <div class="personel-stat-value">{{ genelOzet.toplamParoPuan |
                                            currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                    </div>
                                    <div class="personel-stat">
                                        <div class="personel-stat-label">Mobil Ödeme</div>
                                        <div class="personel-stat-value">{{ genelOzet.toplamMobilOdeme |
                                            currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                    </div>
                                </div>
                                <div class="fark-badge success full"
                                    style="justify-content: space-between; margin-top: 0.5rem;">
                                    <span>Toplam Tahsilat</span>
                                    <span style="font-size: 1rem;">{{ (genelOzet.toplamNakit +
                                        genelOzet.toplamKrediKarti + genelOzet.toplamParoPuan +
                                        genelOzet.toplamMobilOdeme) | currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Kredi Kartı Detayları Card -->
                        <div class="personel-detay-card">
                            <div class="personel-detay-header" style="border: none; margin: 0; padding-bottom: 0;">
                                <div class="personel-detay-avatar"
                                    style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                                    <i class="pi pi-credit-card" style="color: white;"></i>
                                </div>
                                <span class="personel-detay-name">Kredi Kartı Detayları</span>
                            </div>
                            <div style="margin-top: 0.75rem;">
                                <div *ngFor="let item of pusulaKrediKartiDetaylari" class="personel-stat full"
                                    style="margin-bottom: 0.5rem;" [ngClass]="{'highlight-blue': item.isSpecial}">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span class="personel-stat-label"
                                            style="text-transform: none; font-size: 0.8rem;">{{ item.banka }}</span>
                                        <span class="personel-stat-value"
                                            [ngClass]="{'color': item.isSpecial ? '#8b5cf6' : '#1e293b'}">
                                            {{ item.tutar | currency:'TRY':'symbol-narrow':'1.2-2' }}
                                        </span>
                                    </div>
                                </div>
                                <div *ngIf="pusulaKrediKartiDetaylari.length === 0"
                                    style="text-align: center; padding: 1rem; color: #94a3b8;">
                                    Kredi kartı detayı bulunamadı
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DESKTOP VIEW: Original Layout -->
                    <div class="hidden md:grid grid-cols-1 md:grid-cols-2 gap-8 mt-4">
                        <!-- Sol: Tahsilat Özeti -->
                        <div class="flex flex-col gap-4">
                            <h3 class="text-lg font-bold border-b pb-2">Tahsilat Özeti</h3>
                            <div class="flex justify-between p-3 bg-surface-50 rounded">
                                <span>Nakit</span>
                                <span class="font-bold">{{ genelOzet.toplamNakit |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <div class="flex justify-between p-3 rounded">
                                <span>Kredi Kartı</span>
                                <span class="font-bold text-blue-600">{{
                                    genelOzet.toplamKrediKarti |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <div class="flex justify-between p-3 bg-surface-50 rounded">
                                <span>Paro Puan</span>
                                <span class="font-bold">{{ genelOzet.toplamParoPuan |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <div class="flex justify-between p-3 rounded">
                                <span>Mobil Ödeme</span>
                                <span class="font-bold">{{ genelOzet.toplamMobilOdeme |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <div class="flex justify-between p-3 bg-green-50 rounded border border-green-100 mt-2">
                                <span class="font-bold text-green-800">Toplam Tahsilat</span>
                                <span class="font-bold text-green-800">{{ (genelOzet.toplamNakit +
                                    genelOzet.toplamKrediKarti + genelOzet.toplamParoPuan +
                                    genelOzet.toplamMobilOdeme) |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                        </div>

                        <!-- Sağ: Kredi Kartı Detayları -->
                        <div class="flex flex-col gap-4">
                            <h3 class="text-lg font-bold border-b pb-2">Kredi Kartı Detayları
                            </h3>
                            <p-table [value]="pusulaKrediKartiDetaylari" styleClass="p-datatable-sm p-datatable-striped"
                                [scrollable]="true" scrollHeight="300px">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th>Banka</th>
                                        <th class="text-right">Tutar</th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-item>
                                    <tr
                                        [ngClass]="{'border-t-2 border-dashed border-surface-300 dark:border-surface-600': item.showSeparator}">
                                        <td
                                            [ngClass]="{'font-bold text-surface-900 dark:text-surface-0': item.isSpecial}">
                                            {{item.banka}}
                                        </td>
                                        <td class="text-right font-bold"
                                            [ngClass]="{'text-purple-600': item.isSpecial}">
                                            {{item.tutar |
                                            currency:'TRY':'symbol-narrow':'1.2-2'}}
                                        </td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="2" class="text-center p-4 text-muted-color">Kredi kartı
                                            detayı
                                            bulunamadı.</td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </div>
                </p-tabpanel>

                <!-- SEKME 3: MARKET -->
                <p-tabpanel value="2">
                    <!-- MOBILE VIEW -->
                    <div class="block md:hidden mt-4" *ngIf="marketOzet">
                        <div class="personel-detay-card mb-4">
                            <div class="personel-detay-header" style="border: none; margin: 0; padding-bottom: 0;">
                                <div class="personel-detay-avatar"
                                    style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                                    <i class="pi pi-shopping-cart" style="color: white;"></i>
                                </div>
                                <span class="personel-detay-name">Market Özeti</span>
                            </div>
                            <div style="margin-top: 0.75rem;">
                                <div class="personel-detay-grid">
                                    <div class="personel-stat highlight-blue">
                                        <div class="personel-stat-label">Z Raporu</div>
                                        <div class="personel-stat-value">{{ marketOzet.zRaporuToplam |
                                            currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                    </div>
                                    <div class="personel-stat">
                                        <div class="personel-stat-label">Toplam KDV</div>
                                        <div class="personel-stat-value">{{ marketOzet.kdvDokum.toplam |
                                            currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                    </div>
                                    <div class="personel-stat highlight-green">
                                        <div class="personel-stat-label">Tahsilat</div>
                                        <div class="personel-stat-value">{{ marketOzet.tahsilatToplam |
                                            currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                    </div>
                                    <div class="personel-stat highlight-red">
                                        <div class="personel-stat-label">Giderler</div>
                                        <div class="personel-stat-value" style="color: #dc2626;">-{{
                                            marketOzet.giderToplam | currency:'TRY':'symbol-narrow':'1.2-2' }}</div>
                                    </div>
                                </div>
                                <div class="fark-badge"
                                    style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); color: #1d4ed8; justify-content: space-between; margin-top: 0.5rem;">
                                    <span>Net Kasa</span>
                                    <span style="font-size: 1rem; font-weight: 700;">{{ marketOzet.netKasa |
                                        currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DESKTOP VIEW -->
                    <div class="hidden md:grid grid-cols-1 md:grid-cols-2 gap-8 mt-4" *ngIf="marketOzet">
                        <div class="flex flex-col gap-4">
                            <h3 class="text-lg font-bold border-b pb-2">Z-Raporu ve Satışlar
                            </h3>
                            <div class="flex justify-between p-3 bg-surface-50 rounded">
                                <span>Z Raporu Toplamı</span>
                                <span class="font-bold">{{ marketOzet.zRaporuToplam |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <div class="flex justify-between p-3 rounded">
                                <span>Toplam KDV</span>
                                <span>{{ marketOzet.kdvDokum.toplam |
                                    currency:'TRY':'symbol-narrow':'1.2-2'
                                    }}</span>
                            </div>
                        </div>
                        <div class="flex flex-col gap-4">
                            <h3 class="text-lg font-bold border-b pb-2">Kasa Durumu</h3>
                            <div class="flex justify-between p-3 bg-surface-50 rounded">
                                <span>Toplam Tahsilat (Nakit+KK)</span>
                                <span class="font-bold text-green-600">{{
                                    marketOzet.tahsilatToplam |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <div class="flex justify-between p-3 rounded">
                                <span>Market Giderleri</span>
                                <span class="text-red-500">- {{ marketOzet.giderToplam |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                            <div class="flex justify-between p-3 bg-blue-50 rounded border border-blue-100">
                                <span class="font-bold text-blue-800">Net Kasa</span>
                                <span class="font-bold text-blue-800">{{ marketOzet.netKasa |
                                    currency:'TRY':'symbol-narrow':'1.2-2' }}</span>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="!marketOzet" class="text-center p-8 text-muted-color">Market
                        verisi bulunamadı.
                    </div>
                </p-tabpanel>
            </p-tabpanels>
        </p-tabs>

        <div class="flex justify-end mt-6 pt-6 border-t border-surface-200">
            <p-button label="Kapat" icon="pi pi-times" severity="secondary" (onClick)="detayVisible = false"></p-button>
        </div>
    </div>
</p-dialog>