<p-toast></p-toast>

<!-- MOBILE NATIVE VIEW -->
<div class="logs-page block md:hidden">
    <!-- Mobile Native Header -->
    <div class="mobile-page-header">
        <div class="page-title-row">
            <div>
                <h1 class="page-title">İşlem Geçmişi</h1>
                <p class="page-subtitle">Vardiya logları ve takibi</p>
            </div>
            <div class="logs-count">
                <span class="count-badge">{{ loglar.length }}</span>
            </div>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
        <div class="search-input-wrapper">
            <i class="pi pi-search"></i>
            <input type="text" class="search-input" placeholder="İşlem veya açıklama ara..."
                (input)="dt.filterGlobal($any($event.target).value, 'contains')">
        </div>
    </div>

    <!-- Mobile Logs List -->
    <div class="logs-list">
        <div *ngFor="let log of loglar" class="log-card">
            <div class="log-header">
                <div class="log-id-vardiya">
                    <span class="log-id">#{{ log.id }}</span>
                    <span class="log-vardiya">{{ log.vardiyaDosyaAdi }}</span>
                </div>
                <div class="log-date">
                    <div class="log-date-value">{{ log.islemTarihi | date:'dd.MM.yyyy' }}</div>
                    <div class="log-time-value">{{ log.islemTarihi | date:'HH:mm' }}</div>
                </div>
            </div>

            <div class="log-body">
                <div class="log-row">
                    <div class="log-field">
                        <div class="field-label">İstasyon</div>
                        <div class="field-value">{{ log.istasyonAdi }}</div>
                    </div>
                    <div class="log-field text-right">
                        <p-tag [value]="getIslemLabel(log.islem)" [severity]="getIslemSeverity(log.islem)"
                            [icon]="'pi ' + getIslemIcon(log.islem)" [style]="{fontSize: '0.7rem'}"></p-tag>
                    </div>
                </div>

                <div class="log-aciklama" *ngIf="log.aciklama">
                    {{ log.aciklama }}
                </div>

                <div class="log-islem-row" *ngIf="log.eskiDurum || log.yeniDurum">
                    <div class="durum-change">
                        <span class="old-durum">{{ log.eskiDurum || 'BAŞLANGIÇ' }}</span>
                        <i class="pi pi-arrow-right"></i>
                        <span class="new-durum">{{ log.yeniDurum }}</span>
                    </div>
                </div>

                <div class="log-user-info">
                    <i class="pi pi-user"></i>
                    <span class="user-name">{{ log.kullaniciAdi }}</span>
                    <p-tag [value]="log.kullaniciRol" severity="secondary" [style]="{fontSize: '0.6rem'}"></p-tag>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="loglar.length === 0 && !loading" class="empty-state">
            <div class="empty-icon"><i class="pi pi-history"></i></div>
            <div class="empty-title">Kayıt Bulunamadı</div>
            <div class="empty-text">Henüz bir işlem kaydı oluşturulmamış.</div>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-state">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loglar yükleniyor...</div>
        </div>
    </div>
</div>

<!-- DESKTOP VIEW -->
<div class="grid grid-cols-12 gap-6 hidden md:grid">
    <!-- Başlık -->
    <div class="col-span-12">
        <div class="card">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-[var(--text-color)] m-0">
                        <i class="pi pi-history mr-2 text-purple-500"></i>Vardiya İşlem Geçmişi
                    </h2>
                    <p class="text-[var(--text-color-secondary)] mt-2">
                        Tüm vardiya işlemlerinin detaylı kaydı ve log takibi
                    </p>
                </div>
                <div class="flex gap-2">
                    <p-button icon="pi pi-refresh" label="Yenile" severity="secondary" [text]="true"
                        (onClick)="loglariYukle()">
                    </p-button>
                </div>
            </div>
        </div>
    </div>

    <!-- İşlem Geçmişi Tablosu -->
    <div class="col-span-12">
        <div class="card">
            <p-table [value]="loglar" [loading]="loading" [paginator]="loglar.length > 20" [rows]="20"
                [rowsPerPageOptions]="[10, 20, 50, 100]" styleClass="p-datatable-striped"
                [globalFilterFields]="['vardiyaDosyaAdi', 'istasyonAdi', 'kullaniciAdi', 'aciklama']" #dt>

                <ng-template pTemplate="caption">
                    <div class="flex justify-between items-center">
                        <span class="text-xl font-bold">İşlem Kayıtları ({{ loglar.length }})</span>
                        <p-iconfield>
                            <p-inputicon class="pi pi-search" />
                            <input pInputText type="text" placeholder="Ara..."
                                (input)="dt.filterGlobal($any($event.target).value, 'contains')" />
                        </p-iconfield>
                    </div>
                </ng-template>

                <ng-template pTemplate="header">
                    <tr class="text-sm">
                        <th style="width: 80px">ID</th>
                        <th>Vardiya</th>
                        <th>İstasyon</th>
                        <th class="text-center" style="width: 180px">İşlem</th>
                        <th>Açıklama</th>
                        <th style="width: 150px">Kullanıcı</th>
                        <th class="text-center" style="width: 100px">Rol</th>
                        <th style="width: 140px">Durum Değişimi</th>
                        <th class="text-center" style="width: 180px">Tarih</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-log>
                    <tr class="hover:bg-surface-50 dark:hover:bg-surface-800 transition-colors">
                        <td><span class="text-[var(--text-color-secondary)]">#</span>{{ log.id }}</td>
                        <td><span class="font-bold text-[var(--text-color)]">{{ log.vardiyaDosyaAdi
                                }}</span></td>
                        <td class="text-[var(--text-color)]">{{ log.istasyonAdi }}</td>
                        <td class="text-center">
                            <p-tag [value]="getIslemLabel(log.islem)" [severity]="getIslemSeverity(log.islem)"
                                [icon]="'pi ' + getIslemIcon(log.islem)"></p-tag>
                        </td>
                        <td class="text-[var(--text-color)]">
                            <span class="text-sm text-[var(--text-color-secondary)]">{{ log.aciklama }}</span>
                        </td>
                        <td class="text-[var(--text-color)]">{{ log.kullaniciAdi }}</td>
                        <td class="text-center text-[var(--text-color)]">
                            <p-tag [value]="log.kullaniciRol" severity="secondary"></p-tag>
                        </td>
                        <td>
                            <div class="flex items-center gap-2 text-xs" *ngIf="log.eskiDurum || log.yeniDurum">
                                <span class="text-[var(--text-color-secondary)]">{{ log.eskiDurum || 'BAŞLANGIÇ'
                                    }}</span>
                                <i
                                    class="pi pi-arrow-right text-[10px] text-[var(--text-color-secondary)] opacity-50"></i>
                                <span class="font-bold text-primary">{{ log.yeniDurum }}</span>
                            </div>
                        </td>
                        <td class="text-center">
                            <span class="text-[var(--text-color)]">{{ log.islemTarihi | date:'dd.MM.yyyy
                                HH:mm' }}</span>
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="9" class="text-center py-12">
                            <div class="flex flex-col items-center">
                                <div
                                    class="w-24 h-24 bg-[var(--surface-ground)] rounded-full flex items-center justify-center mb-4 border border-[var(--surface-border)]">
                                    <i class="pi pi-history text-4xl text-[var(--text-color-secondary)] opacity-50"></i>
                                </div>
                                <h4 class="text-[var(--text-color-secondary)] m-0">Kayıt bulunamadı</h4>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>